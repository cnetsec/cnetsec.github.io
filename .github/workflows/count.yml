- name: ğŸ“Š Contar CVEs
        run: |
          python3 - <<EOF
import re
from collections import defaultdict, Counter

def normalizar(texto):
    texto = texto.replace('â€‘', '-')
    texto = re.sub(r'<br\s*/?>', '\n', texto, flags=re.IGNORECASE)
    texto = re.sub(r'<[^>]+>', '', texto)
    return texto

def extrair_blocos(texto):
    blocos = re.split(r'\*\*(.+?)\*\*', texto)
    return [(blocos[i].strip(), blocos[i+1].strip()) for i in range(1, len(blocos), 2)]

def extrair_cves(texto):
    return [cve.replace('â€‘', '-').upper() for cve in re.findall(r'cve[-â€‘]\d{4}[-â€‘]\d{4,6}', texto, flags=re.IGNORECASE)]

def extrair_pais(texto):
    match = re.search(r'(ğŸ‡§ğŸ‡·|ğŸ‡¦ğŸ‡·|ğŸ‡¨ğŸ‡±|ğŸ‡µğŸ‡¾|ğŸ‡ºğŸ‡¾|ğŸ‡µğŸ‡ª|ğŸ‡ªğŸ‡¨|ğŸ‡¨ğŸ‡´|ğŸ‡»ğŸ‡ª|ğŸ‡§ğŸ‡´|ğŸ‡¬ğŸ‡¾|ğŸ‡¸ğŸ‡·|ğŸ‡¬ğŸ‡«)', texto)
    return match.group(1) if match else "ğŸŒ"

with open("README.md", "r", encoding="utf-8") as f:
    conteudo = normalizar(f.read())

por_pessoa = defaultdict(set)
por_pais = defaultdict(set)
todos = []

for nome, bloco in extrair_blocos(conteudo):
    cves = extrair_cves(bloco)
    pais = extrair_pais(bloco)
    todos.extend(cves)
    por_pessoa[nome].update(cves)
    por_pais[pais].update(cves)

print(f"ğŸ”¢ Total bruto de CVEs: {len(todos)}")
print(f"âœ… Total Ãºnico de CVEs: {len(set(todos))}")

print("\nğŸ… Top 5 pesquisadores:")
for nome, cves in sorted(por_pessoa.items(), key=lambda x: len(x[1]), reverse=True)[:5]:
    print(f" - {nome}: {len(cves)} CVEs")

print("\nğŸŒ CVEs por paÃ­s:")
for pais, cves in sorted(por_pais.items(), key=lambda x: len(x[1]), reverse=True):
    print(f" - {pais}: {len(cves)}")
EOF
